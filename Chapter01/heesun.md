## Chapter 01. 첫 번째 예시 (11.02~11.16)

- 프로그램 구조가 빈약하다면 구조 재구성부터 시작한다.
- 구조 재구성 후 여러 함수와 프로그램 요소로 재구성한다.

### 1.3 리팩터링의 첫 단계

- 리팩터링에서 테스트의 역할은 매우 중요하다. 테스트 코드를 여러개 준비한다.
- 신속한 테스트를 위해 자가진단 테스트를 만든다.
- 리팩터링 전에 테스트를 마련하고, 테스트는 반드시 자가진하도록 만든다.
(원하는 내용을 테스트 코드와 소스 코드 양쪽에 적어둔다.)


> 💡 자바스크립트 컴파일러 : bebeljs.io


### 1.4 함수 쪼개기

- 코드를 분석해서 얻은 정보는 휘발성이 높으므로 분석할 필요없이 코드 스스로 동작하도록 함수로 추출한다.
- 로컬 범위에 존재하는 임시 변수들은 질의 함수로 바꾼다.
(const play = palyFor(perf))
- 임시 변수(로컬변수, 지역변수)는 자신이 속한 루틴에서만 의미가 있어서 많아질수록 길고 복잡해지므로 최대한 제거하는 것이 좋다.
- 함수를 쪼갤 때 함수가 하는 일을 알 수 있는 이름을 짓는 것이 중요하다. 이름이 너무 장황해도 좋지 않다.
- 코드가 복잡할수록 단계를 작게 나누면 작업 속도가 빨라진다.
- 성능에 대한 고민은 리팩터링 후에 한다.

✅ **함수 쪼개기 단계**

1. 반복문 쪼개기
2. 문장 슬라이드하기 : 변수 초기화 문장을 변수 값 누적 코드  바로 앞으로 옮긴다.
3. 함수 추출하기 : 계산된 코드를 별도 함수로 추출한다.
4. 변수 인라인하기 : 변수를 제거하고 별도로 추출한 함수를 인라인한다.


### 1.5 중간 점검: 난무하는 중첩 함수

- 코드로 계산되는 로직은 모두 보조 함수로 빼면 계산 과정과 전체 흐름을 파악하기가 쉬워진다.

🔗[중첩함수 사용](https://github.com/HeesunYoon/refactoring/tree/09c1375bf71d77474b6037b955761f50a8cd82e5)

### 1.6 계산 단계와 포맷팅 단계 분리하기

- 중간 데이터 구조를 만들어서 중첩 함수를 줄일 수 있다.

```jsx
invoice.performances.map(enrichPerformance);
Object.assign({}, aPerformance) 는 얕은 복사를 수행한다.
```

### 1.7 중간 점검 : 두 파일(과 두 단계)로 분리됨

- 계산 부분과 출력 형식을 분리, 모듈화하여 각 부분이 하는 일과 돌아가는 과정을 파악하기 쉬워진다.

🔗[중간 데이터 구조 역할을 할 객체 만들기](https://github.com/HeesunYoon/refactoring/tree/c73fe1637c0c9508e8edac809fb63820248eee4a)

🔗[조건부 로직을 객체지향 문법으로 변경](https://github.com/HeesunYoon/refactoring/tree/d4802f1c3197303925613cb9f385f9d8690f1929)


### 1.8 다형성을 활용해 계산 코드 재구성하기

- ECMAScript2015 버전(ES6)에서 제공하는 객체지향 문법과 구조를 활용해 **조건부 로직을 다형성**으로 바꾼다. (계산 로직의 상속 계층 정의 필요)
- 다형성 지원을 위해 타입코드를 서브 클래스로 바꾸고 생성자를 팩터리 함수로 변경한다.

🔗[클래스와 팩터리 함수로 변경](https://github.com/HeesunYoon/refactoring/tree/287beed72abcd4c2139af3fbb976262d54471435)

🔗[조건부 로직을 다형성으로 바꾸기](https://github.com/HeesunYoon/refactoring/tree/84cff5c6d540883d99ab8083c1255c10184999a4)

### 1.9 ~ 1.10 

- 리팩터링의 세 단계
    1. 원본 함수를 중첩 함수 여러 개로 나누기
    2. 단계 쪼개기를 적용하여 계산 코드와 출력 코드 분리
    3. 계산 로직을 다형성으로 표현


---

> 📝 처음 책에 나와있는대로 리팩터링 코드를 작성하면서 든 생각은 이렇게 함수를 많이 쪼개도 되나? 리팩토링은 코드를 단순하게 만드는게 아니었나? 더 복잡해지는 것 같다. 였습니다.
함수 여러개가 중첩되서 동작하고 있을 때도 이게 맞나 싶었는데 1.6장부터 계산과 출력 부분을 나누고 코드를 재구성하는 것을 보고 이런 식으로 리팩터링을 할 수 있구나 하는 생각이 들었고 현업에서 사용하려면 시간이 조금 필요하겠다는 생각도 들었습니다. 
<br/>
