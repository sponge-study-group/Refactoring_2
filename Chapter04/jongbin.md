# 제 4장 테스트 구축하기

<aside>
💡 리팩터링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트가 뒷받침 되어야 한다.

</aside>

- 리팩터링을 하지 않더라도 좋은 테스트를 작성하는 일은 개발 효율을 높여준다.

## 4.1 자가 테스트 코드의 가치

<aside>
💡 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자

</aside>

1. 프로그래머들이 코드를 작성하는 시간의 비중은 그리 크지 않다.
    1. 현재 상황을 파악하기도 하고, 설계를 고민하기도 한다.물론 대부분의 시간은 디버깅에 쓴다.

<aside>
💡 테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다.

</aside>

1. 컴파일할 때마다 테스트도 함께 했고, 곧바로 생산성이 급상승했다. 디버깅 시간이 크게 줄어든 것이다.
    1. 자가 테스트 코드 자체뿐 아니라 테스트를 자주 수행하는 습관도 버그를 찾는 강력한 도구가 된다.
2. 사실 다른 사람에게 이런 식으로 개발하라고 설득하기는 녹록치 않다.
    1. 본체 외의 부가적인 코드를 상당량 작성해야 한다.
    2. 테스트가 실제로 프로그래밍 속도를 높여주는 경험을 직접 해보지 않고서는 자가 테스트의 진가를 납득하긴 어렵다.
    3. 테스트를 수동으로 하면 좀이 쑤실 정도로 지겹다. 하지만 자동화 한다면 테스트 코드를 작성하는 재미가 꽤 쏠쏠하다.
3. 테스트를 작성하기 가장 좋은 시점
    1. 프로그래밍을 시작하기 전이다.
4. TDD 에서는 (처음에는 통과하지 못할) 테스트를 작성하고, 이 테스트를 통과하게끔 코드를 작성하고, 결과 코드를 최대한 깔끔하게 리팩터링하는 과정을 짧은 주기로 반복한다.
5. 리팩터링에는 테스트가 필요하다. 그러니 리팩터링하고 싶다면 테스트를 반드시 작성해야 한다.

## 4.3 첫 번째 테스트

<aside>
💡 실패해야 할 상황에서는 반드시 실패하게 만들자.
자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자.

</aside>

1. 시중에는 다양한 프레임워크가 있는데, 자바스크립트용으로 나온 것만 해도 여러 개다. 여기서는 현재 널리 쓰이고 나름 좋다고 알려진 모카를 사용한다.
2. 테스트는 it 블록에 담긴다.
    1. 첫번째 단계에서는 테스트에 필요한 데이터와 객체를 뜻하는 픽스처를 설정한다.
    2. 두 번째 단계에서는 이 픽스처의 속성들을 검증하는데, 여기서는 주어진 초깃값에 기초하여 생산 부족분을 정확히 계산했는지 확인한다.
3. 각각의 테스트가 실패하는 모습을 최소한 한 번씩은 직접 확인해본다.
    1. 일시적으로 코드에 오류를 주입하는 것이다.
4. 뛰어난 테스트 프레임워크를 사용한다면 이렇게 많은 테스트도 간편하게 실행할 수 있고 무언가 실패한다면 금방 확인할 수 있다. 간결한 피드백은 자가 테스트에서 매우 중요하다.
5. 실패한 테스트가 하나라도 있으면 리팩터링하면 안된다.
6. 핵심은 모든 테스트가 통과했다는 사실을 빨리 알 수 있냐는 데 있다.

## 4.4 테스트 추가하기

<aside>
💡 완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는게 낫다.

</aside>

1. 테스트는 위험요인을 중심으로 작성해야 한다.
    1. 테스트의 목적은 어디까지나 현재 혹은 향후에 발생하는 버그를 찾는 데 있다.
    2. 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요가 없다.

## 4.5 픽스처 수정하기

1. beforeEach 블록에서 ‘설정’한 표준 픽스처를 취해서, 테스트를 ‘수행’하고, 이 픽스처가 일을 기대한 대로 처리했는지 ‘검증’ 한다.
    1. 패턴을 설정-실행-검증, 조건-발생-결과, 준비-수행,단언 등으로 부른다는 것을 알 것이다.

## 4.6 경계 조건 검사하기

<aside>
💡 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자.

</aside>

<aside>
💡 어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 잇는 기회를 날리는 셈이다.

</aside>

1. 리팩터링은 겉보기 동작에 영향을 주지 않아야 하며, 이런 오류는 겉보기 동작에 해당하지 않는다. 따라서 경계 조건에 대응하는 동작이 리팩터링 때문에 변하는지는 신경 쓸 필요 없다.
2. 테스트가 모든 버그를 걸러주지 못할지라도, 안심하고 리팩터링할 수 있는 보호막은 되어준다. 그리고 리팩터링을 하면서 프로그램을 더욱 깊이 이해하게 되어 더 많은 버그를 찾게 된다.

## 4.7 끝나지 않은 여정

<aside>
💡 버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.

</aside>